{"version":3,"file":"core-components.min.js","sources":["../packages/utils.js","../packages/core-toggle/core-toggle.js","../packages/core-input/core-input.js"],"sourcesContent":["export const IS_BROWSER = typeof window !== 'undefined'\nexport const IS_ANDROID = IS_BROWSER && /(android)/i.test(navigator.userAgent) // Bad, but needed\nexport const IS_IOS = IS_BROWSER && /iPad|iPhone|iPod/.test(String(navigator.platform))\n\n/**\n* addEvent\n* @param {String} uuid An unique ID of the event to bind - ensurnes single instance\n* @param {String} type The type of event to bind\n* @param {Function} handler The function to call on event\n*/\nexport function addEvent (uuid, type, handler) {\n  const useCaptureForOldFirefox = type === 'blur' || type === 'focus'\n  const id = `${uuid}-${type}`\n\n  if (typeof window === 'undefined' || window[id]) return                       // Ensure single instance\n  document.addEventListener(window[id] = type, handler, useCaptureForOldFirefox)\n}\n\nexport function ariaExpand (master, open) {\n  const relatedTarget = ariaTarget(master)\n  const prevState = master.getAttribute('aria-expanded') === 'true'\n  const wantState = typeof open === 'boolean' ? open : (open === 'toggle' ? !prevState : prevState)\n  const canUpdate = prevState === wantState || dispatchEvent(master, 'toggle', {relatedTarget, isOpen: prevState})\n  const nextState = canUpdate ? wantState : prevState\n\n  relatedTarget[nextState ? 'removeAttribute' : 'setAttribute']('hidden', '')   // Toggle hidden attribute\n  master.setAttribute('aria-expanded', nextState)                               // Set expand always\n  return nextState\n}\n\nexport function ariaTarget (master, relationType) {\n  const targetId = master.getAttribute('aria-controls') || master.getAttribute('aria-owns')\n  const target = document.getElementById(targetId) || master.nextElementSibling\n  const label = IS_ANDROID ? 'data' : 'aria'   // Andriod has a bug and reads only label instead of content\n\n  if (!target) throw new Error(`missing nextElementSibling on ${master.outerHTML}`)\n  if (relationType) {\n    master.setAttribute(`aria-${relationType}`, target.id = target.id || getUUID())\n    target.setAttribute(`${label}-labelledby`, master.id = master.id || getUUID())\n  }\n  return target\n}\n\n/**\n* escapeHTML\n* @param {String} str A string with potential html tokens\n* @return {String} Escaped HTML string according to OWASP recommendation\n*/\nconst ESCAPE_MAP = {'&': '&amp;', '<': '&lt;', '>': '&gt;', '\"': '&quot;', '/': '&#x2F;', '\\'': '&#x27;'}\nexport function escapeHTML (str) {\n  return String(str || '').replace(/[&<>\"'/]/g, (char) => ESCAPE_MAP[char])\n}\n\n/**\n* exclude\n* @param {Object} target The target object\n* @param {Object} exclude The source to exclude keys from\n* @return {Object} The target object without keys found in source\n*/\nexport function exclude (target, exclude) {\n  return Object.keys(target).reduce((acc, key) => {\n    if (!exclude.hasOwnProperty(key)) acc[key] = target[key]\n    return acc\n  }, {})\n}\n\n/**\n* dispatchEvent\n* @param {Element} elem The target object\n* @param {String} name The source object(s)\n* @param {Object} detail Detail object (bubbles and cancelable is set to true)\n* @return {Boolean} Whether the event was cance\n*/\nexport function dispatchEvent (elem, name, detail = {}) {\n  let event\n  if (typeof window.CustomEvent === 'function') {\n    event = new window.CustomEvent(name, {bubbles: true, cancelable: true, detail})\n  } else {\n    event = document.createEvent('CustomEvent')\n    event.initCustomEvent(name, true, true, detail)\n  }\n\n  return elem.dispatchEvent(event)\n}\n\n/**\n* getUUID\n* @return {String} A generated unique ID\n*/\nexport function getUUID (el, attr) {\n  return Date.now().toString(36) + Math.random().toString(36).slice(2, 5)\n}\n\n/**\n* queryAll\n* @param {String|NodeList|Array|Element} elements A CSS selector string, nodeList, element array, or single element\n* @return {Array} Array of elements\n*/\nexport function queryAll (elements, context = document) {\n  if (elements.nodeType) return [elements]\n  if (typeof elements === 'string') return [].slice.call(context.querySelectorAll(elements))\n  if (elements.length) return [].slice.call(elements)\n  return []\n}\n","import {name, version} from './package.json'\nimport {addEvent, ariaExpand, ariaTarget, queryAll} from '../utils'\n\nconst UUID = `data-${name}-${version}`.replace(/\\W+/g, '-')         // Strip invalid attribute characters\nconst OPEN = 'aria-expanded'\nconst POPS = 'aria-haspopup'\n\nexport default function toggle (selector, open) {\n  const options = typeof open === 'object' ? open : {open}\n  const setOpen = typeof options.open === 'boolean'\n  const setPops = typeof options.popup === 'boolean'\n\n  return queryAll(selector).forEach((button) => {\n    const open = setOpen ? options.open : button.getAttribute(OPEN) === 'true'\n    const pops = setPops ? options.popup : button.getAttribute(POPS) === 'true'\n\n    button.setAttribute(UUID, '')\n    button.setAttribute(POPS, pops)\n\n    ariaTarget(button, 'controls')\n    ariaExpand(button, open)\n    return button\n  })\n}\n\naddEvent(UUID, 'click', ({target}) => {\n  queryAll(`[${UUID}]`).forEach((el) => {\n    const open = el.getAttribute(OPEN) === 'true'\n    const pops = el.getAttribute(POPS) === 'true'\n\n    if (el.contains(target)) toggle(el, !open)                  // Click on toggle\n    else if (pops) toggle(el, ariaTarget(el).contains(target))  // Click in target or outside\n  })\n})\n","import {name, version} from './package.json'\nimport {IS_IOS, addEvent, escapeHTML, dispatchEvent, queryAll} from '../utils'\n\nconst UUID = `data-${name}-${version}`.replace(/\\W+/g, '-') // Strip invalid attribute characters\nconst KEYS = {ENTER: 13, SHIFT: 16, ESC: 27, PAGEUP: 33, PAGEDOWN: 34, END: 35, HOME: 36, UP: 38, DOWN: 40}\nconst ROLE = IS_IOS ? 'data-role' : 'role'                  // iOS does not inform user area is editable if combobox\nconst ITEM = '[tabindex=\"-1\"]'\n\nexport default function input (elements, items) {\n  const options = typeof items === 'object' ? items : {items}\n  const repaint = typeof options.items === 'string'\n\n  return queryAll(elements).forEach((input) => {\n    const list = input.nextElementSibling\n\n    input.setAttribute(UUID, '')\n    input.setAttribute(ROLE, 'combobox')\n    input.setAttribute('autocomplete', 'off')\n    input.setAttribute('aria-autocomplete', 'list')\n\n    if (repaint) list.innerHTML = options.items\n    queryAll('a,button', list).forEach(setupItem)\n    setupExpand(input, options.open)\n    return input\n  })\n}\n\naddEvent(UUID, 'click', onClickOrFocus)\naddEvent(UUID, 'focus', onClickOrFocus)\nfunction onClickOrFocus (event) {\n  if (event.ctrlKey || event.altKey || event.metaKey || event.defaultPrevented) return\n\n  queryAll(`[${UUID}]`).forEach((input) => {\n    const list = input.nextElementSibling\n    const open = input === event.target || list.contains(event.target)\n    const item = open && event.type === 'click' && queryAll(ITEM, list).filter((item) => item.contains(event.target))[0]\n\n    if (item) onSelect(input, {relatedTarget: list, currentTarget: item})\n    else setupExpand(input, open)\n  })\n}\n\naddEvent(UUID, 'input', ({target}) => {\n  if (!target.hasAttribute(UUID)) return\n  const match = target.value.replace(/[-\\/\\\\^$*+?.()|[\\]{}]/g, '\\\\$&') || '.^'  // From lodash\n  const regex = new RegExp(match, 'gi')\n\n  onFilter(target, {\n    relatedTarget: target.nextElementSibling,\n    render: (items) => input(target, {items}),\n    highlight: (val) => escapeHTML(val).replace(regex, '<mark>$&</mark>'),\n    escapeHTML,\n    regex\n  })\n})\n\naddEvent(UUID, 'keydown', (event) => {\n  if (event.ctrlKey || event.altKey || event.metaKey) return                    // Let browser do it's thing\n  if (event.target.hasAttribute(UUID)) return onKey(event.target, event)        // Quick check\n  for (let el = event.target, prev; el; el = el.parentElement) {                // Check if inside list\n    if ((prev = el.previousElementSibling) && prev.hasAttribute(UUID)) return onKey(prev, event)\n  }\n})\n\nfunction onKey (input, event) {\n  const list = input.nextElementSibling\n  const focus = queryAll(`${ITEM}:not([hidden])`, list)\n  const index = focus.indexOf(document.activeElement)\n  let item = false\n\n  if (event.keyCode === KEYS.END || event.keyCode === KEYS.PAGEDOWN) item = focus.pop()\n  else if (event.keyCode === KEYS.HOME || event.keyCode === KEYS.PAGEUP) item = focus[0]\n  else if (event.keyCode === KEYS.DOWN) item = focus[index + 1] || focus[0]\n  else if (event.keyCode === KEYS.UP) item = focus[index - 1] || focus.pop()\n  else if (event.keyCode !== KEYS.SHIFT && event.keyCode !== KEYS.ENTER) input.focus()\n\n  setupExpand(input, event.keyCode !== KEYS.ESC)\n  if (item !== false) event.preventDefault()  // preventDefault even if empty list\n  if (item) item.focus()\n}\n\nfunction onSelect (input, detail) {\n  if (dispatchEvent(input, 'input.select', detail)) {\n    const item = detail.currentTarget\n    input.value = item.value || item.textContent.trim()\n    input.focus()\n    setupExpand(input, false)\n  }\n}\n\nfunction onFilter (input, detail) {\n  if (dispatchEvent(input, 'input.type', detail)) {\n    queryAll(ITEM, input.nextElementSibling).reduce((acc, item) => {\n      const show = item.textContent.toLowerCase().indexOf(input.value.toLowerCase()) !== -1\n      item[show ? 'removeAttribute' : 'setAttribute']('hidden', '')\n      return show ? acc.concat(item) : acc\n    }, []).forEach(setupItem)\n  }\n}\n\nfunction setupExpand (input, open = input.getAttribute('aria-expanded') === 'true') {\n  input.nextElementSibling[open ? 'removeAttribute' : 'setAttribute']('hidden', '')\n  input.setAttribute('aria-expanded', open)\n}\n\nfunction setupItem (item, index, items) {\n  item.hasAttribute('aria-label') || item.setAttribute('aria-label', `${item.textContent.trim()}, ${index+1} av ${items.length}`)\n  item.setAttribute('tabindex', '-1')\n}\n"],"names":["IS_BROWSER","window","IS_ANDROID","test","navigator","userAgent","IS_IOS","String","platform","addEvent","uuid","type","handler","const","useCaptureForOldFirefox","id","document","addEventListener","ariaTarget","master","relationType","targetId","getAttribute","target","getElementById","nextElementSibling","label","Error","setAttribute","getUUID","ESCAPE_MAP","&","<",">","\"","/","'","escapeHTML","str","replace","char","dispatchEvent","elem","name","detail","let","event","CustomEvent","bubbles","cancelable","createEvent","initCustomEvent","el","attr","Date","now","toString","Math","random","slice","queryAll","elements","context","nodeType","call","querySelectorAll","length","UUID","OPEN","POPS","toggle","selector","open","options","setOpen","setPops","popup","forEach","button","pops","relatedTarget","prevState","wantState","nextState","isOpen","ariaExpand","ref","contains","KEYS","ENTER","SHIFT","ESC","PAGEUP","PAGEDOWN","END","HOME","UP","DOWN","ROLE","ITEM","input","items","repaint","list","innerHTML","setupItem","setupExpand","onClickOrFocus","ctrlKey","altKey","metaKey","defaultPrevented","item","filter","currentTarget","value","textContent","trim","focus","onSelect","onKey","index","indexOf","activeElement","keyCode","pop","preventDefault","hasAttribute","match","regex","RegExp","reduce","acc","show","toLowerCase","concat","onFilter","render","highlight","val","prev","parentElement","previousElementSibling"],"mappings":"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"}