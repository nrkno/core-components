{"version":3,"file":"core-input.min.js","sources":["../utils.js","core-input.js"],"sourcesContent":["export const IS_BROWSER = typeof window !== 'undefined'\nexport const IS_ANDROID = IS_BROWSER && /(android)/i.test(navigator.userAgent) // Bad, but needed\nexport const IS_IOS = IS_BROWSER && /iPad|iPhone|iPod/.test(String(navigator.platform))\n\n/**\n* addEvent\n* @param {String} uuid An unique ID of the event to bind - ensurnes single instance\n* @param {String} type The type of event to bind\n* @param {Function} handler The function to call on event\n*/\nexport function addEvent (uuid, type, handler) {\n  const useCaptureForOldFirefox = type === 'blur' || type === 'focus'\n  const id = `${uuid}-${type}`\n\n  if (typeof window === 'undefined' || window[id]) return                       // Ensure single instance\n  document.addEventListener(window[id] = type, handler, useCaptureForOldFirefox)\n}\n\nexport function ariaExpand (master, open) {\n  const relatedTarget = ariaTarget(master)\n  const prevState = master.getAttribute('aria-expanded') === 'true'\n  const wantState = typeof open === 'boolean' ? open : (open === 'toggle' ? !prevState : prevState)\n  const canUpdate = prevState === wantState || dispatchEvent(master, 'toggle', {relatedTarget, isOpen: prevState})\n  const nextState = canUpdate ? wantState : prevState\n\n  relatedTarget[nextState ? 'removeAttribute' : 'setAttribute']('hidden', '')   // Toggle hidden attribute\n  master.setAttribute('aria-expanded', nextState)                               // Set expand always\n  return nextState\n}\n\nexport function ariaTarget (master, relationType) {\n  const targetId = master.getAttribute('aria-controls') || master.getAttribute('aria-owns')\n  const target = document.getElementById(targetId) || master.nextElementSibling\n  const label = IS_ANDROID ? 'data' : 'aria'   // Andriod has a bug and reads only label instead of content\n\n  if (!target) throw new Error(`missing nextElementSibling on ${master.outerHTML}`)\n  if (relationType) {\n    master.setAttribute(`aria-${relationType}`, target.id = target.id || getUUID())\n    target.setAttribute(`${label}-labelledby`, master.id = master.id || getUUID())\n  }\n  return target\n}\n\n/**\n* escapeHTML\n* @param {String} str A string with potential html tokens\n* @return {String} Escaped HTML string according to OWASP recommendation\n*/\nconst ESCAPE_MAP = {'&': '&amp;', '<': '&lt;', '>': '&gt;', '\"': '&quot;', '/': '&#x2F;', '\\'': '&#x27;'}\nexport function escapeHTML (str) {\n  return String(str || '').replace(/[&<>\"'/]/g, (char) => ESCAPE_MAP[char])\n}\n\n/**\n* exclude\n* @param {Object} target The target object\n* @param {Object} exclude The source to exclude keys from\n* @return {Object} The target object without keys found in source\n*/\nexport function exclude (target, exclude) {\n  return Object.keys(target).reduce((acc, key) => {\n    if (!exclude.hasOwnProperty(key)) acc[key] = target[key]\n    return acc\n  }, {})\n}\n\n/**\n* dispatchEvent\n* @param {Element} elem The target object\n* @param {String} name The source object(s)\n* @param {Object} detail Detail object (bubbles and cancelable is set to true)\n* @return {Boolean} Whether the event was cance\n*/\nexport function dispatchEvent (elem, name, detail = {}) {\n  let event\n  if (typeof window.CustomEvent === 'function') {\n    event = new window.CustomEvent(name, {bubbles: true, cancelable: true, detail})\n  } else {\n    event = document.createEvent('CustomEvent')\n    event.initCustomEvent(name, true, true, detail)\n  }\n\n  return elem.dispatchEvent(event)\n}\n\n/**\n* getUUID\n* @return {String} A generated unique ID\n*/\nexport function getUUID (el, attr) {\n  return Date.now().toString(36) + Math.random().toString(36).slice(2, 5)\n}\n\n/**\n* queryAll\n* @param {String|NodeList|Array|Element} elements A CSS selector string, nodeList, element array, or single element\n* @return {Array} Array of elements\n*/\nexport function queryAll (elements, context = document) {\n  if (elements.nodeType) return [elements]\n  if (typeof elements === 'string') return [].slice.call(context.querySelectorAll(elements))\n  if (elements.length) return [].slice.call(elements)\n  return []\n}\n","import {name, version} from './package.json'\nimport {IS_IOS, addEvent, escapeHTML, dispatchEvent, queryAll} from '../utils'\n\nconst UUID = `data-${name}-${version}`.replace(/\\W+/g, '-') // Strip invalid attribute characters\nconst KEYS = {ENTER: 13, SHIFT: 16, ESC: 27, PAGEUP: 33, PAGEDOWN: 34, END: 35, HOME: 36, UP: 38, DOWN: 40}\nconst ROLE = IS_IOS ? 'data-role' : 'role'                  // iOS does not inform user area is editable if combobox\nconst ITEM = '[tabindex=\"-1\"]'\n\nexport default function input (elements, items) {\n  const options = typeof items === 'object' ? items : {items}\n  const repaint = typeof options.items === 'string'\n\n  return queryAll(elements).forEach((input) => {\n    const list = input.nextElementSibling\n\n    input.setAttribute(UUID, '')\n    input.setAttribute(ROLE, 'combobox')\n    input.setAttribute('autocomplete', 'off')\n    input.setAttribute('aria-autocomplete', 'list')\n\n    if (repaint) list.innerHTML = options.items\n    queryAll('a,button', list).forEach(setupItem)\n    setupExpand(input, options.open)\n    return input\n  })\n}\n\naddEvent(UUID, 'click', onClickOrFocus)\naddEvent(UUID, 'focus', onClickOrFocus)\nfunction onClickOrFocus (event) {\n  if (event.ctrlKey || event.altKey || event.metaKey || event.defaultPrevented) return\n\n  queryAll(`[${UUID}]`).forEach((input) => {\n    const list = input.nextElementSibling\n    const open = input === event.target || list.contains(event.target)\n    const item = open && event.type === 'click' && queryAll(ITEM, list).filter((item) => item.contains(event.target))[0]\n\n    if (item) onSelect(input, {relatedTarget: list, currentTarget: item})\n    else setupExpand(input, open)\n  })\n}\n\naddEvent(UUID, 'input', ({target}) => {\n  if (!target.hasAttribute(UUID)) return\n  const match = target.value.replace(/[-\\/\\\\^$*+?.()|[\\]{}]/g, '\\\\$&') || '.^'  // From lodash\n  const regex = new RegExp(match, 'gi')\n\n  onFilter(target, {\n    relatedTarget: target.nextElementSibling,\n    render: (items) => input(target, {items}),\n    highlight: (val) => escapeHTML(val).replace(regex, '<mark>$&</mark>'),\n    escapeHTML,\n    regex\n  })\n})\n\naddEvent(UUID, 'keydown', (event) => {\n  if (event.ctrlKey || event.altKey || event.metaKey) return                    // Let browser do it's thing\n  if (event.target.hasAttribute(UUID)) return onKey(event.target, event)        // Quick check\n  for (let el = event.target, prev; el; el = el.parentElement) {                // Check if inside list\n    if ((prev = el.previousElementSibling) && prev.hasAttribute(UUID)) return onKey(prev, event)\n  }\n})\n\nfunction onKey (input, event) {\n  const list = input.nextElementSibling\n  const focus = queryAll(`${ITEM}:not([hidden])`, list)\n  const index = focus.indexOf(document.activeElement)\n  let item = false\n\n  if (event.keyCode === KEYS.END || event.keyCode === KEYS.PAGEDOWN) item = focus.pop()\n  else if (event.keyCode === KEYS.HOME || event.keyCode === KEYS.PAGEUP) item = focus[0]\n  else if (event.keyCode === KEYS.DOWN) item = focus[index + 1] || focus[0]\n  else if (event.keyCode === KEYS.UP) item = focus[index - 1] || focus.pop()\n  else if (event.keyCode !== KEYS.SHIFT && event.keyCode !== KEYS.ENTER) input.focus()\n\n  setupExpand(input, event.keyCode !== KEYS.ESC)\n  if (item !== false) event.preventDefault()  // preventDefault even if empty list\n  if (item) item.focus()\n}\n\nfunction onSelect (input, detail) {\n  if (dispatchEvent(input, 'input.select', detail)) {\n    const item = detail.currentTarget\n    input.value = item.value || item.textContent.trim()\n    input.focus()\n    setupExpand(input, false)\n  }\n}\n\nfunction onFilter (input, detail) {\n  if (dispatchEvent(input, 'input.type', detail)) {\n    queryAll(ITEM, input.nextElementSibling).reduce((acc, item) => {\n      const show = item.textContent.toLowerCase().indexOf(input.value.toLowerCase()) !== -1\n      item[show ? 'removeAttribute' : 'setAttribute']('hidden', '')\n      return show ? acc.concat(item) : acc\n    }, []).forEach(setupItem)\n  }\n}\n\nfunction setupExpand (input, open = input.getAttribute('aria-expanded') === 'true') {\n  input.nextElementSibling[open ? 'removeAttribute' : 'setAttribute']('hidden', '')\n  input.setAttribute('aria-expanded', open)\n}\n\nfunction setupItem (item, index, items) {\n  item.hasAttribute('aria-label') || item.setAttribute('aria-label', `${item.textContent.trim()}, ${index+1} av ${items.length}`)\n  item.setAttribute('tabindex', '-1')\n}\n"],"names":["IS_BROWSER","window","IS_IOS","test","navigator","userAgent","String","platform","addEvent","uuid","type","handler","const","useCaptureForOldFirefox","id","document","addEventListener","ESCAPE_MAP","&","<",">","\"","/","'","escapeHTML","str","replace","char","dispatchEvent","elem","name","detail","let","event","CustomEvent","bubbles","cancelable","createEvent","initCustomEvent","queryAll","elements","context","nodeType","slice","call","querySelectorAll","length","UUID","KEYS","ENTER","SHIFT","ESC","PAGEUP","PAGEDOWN","END","HOME","UP","DOWN","ROLE","ITEM","input","items","options","repaint","forEach","list","nextElementSibling","setAttribute","innerHTML","setupItem","setupExpand","open","onClickOrFocus","ctrlKey","altKey","metaKey","defaultPrevented","target","contains","item","filter","currentTarget","value","textContent","trim","focus","onSelect","relatedTarget","onKey","index","indexOf","activeElement","keyCode","pop","preventDefault","getAttribute","hasAttribute","ref","match","regex","RegExp","reduce","acc","show","toLowerCase","concat","onFilter","render","highlight","val","el","prev","parentElement","previousElementSibling"],"mappings":"yLAAaA,EAA+B,oBAAXC,OAEpBC,GADaF,GAAc,aAAaG,KAAKC,UAAUC,WAC9CL,GAAc,mBAAmBG,KAAKG,OAAOF,UAAUG,YAQ7E,SAAgBC,EAAUC,EAAMC,EAAMC,GACpCC,IAAMC,EAAmC,SAATH,GAA4B,UAATA,EAC7CI,EAAKL,MAAWC,EAEA,oBAAXT,QAA0BA,OAAOa,IAC5CC,SAASC,iBAAiBf,OAAOa,GAAMJ,EAAMC,EAASE,GAiCxDD,IAAMK,GAAcC,IAAK,QAASC,IAAK,OAAQC,IAAK,OAAQC,IAAK,SAAUC,IAAK,SAAUC,IAAM,UAChG,SAAgBC,EAAYC,GAC1B,OAAOnB,OAAOmB,GAAO,IAAIC,QAAQ,qBAAcC,UAASV,EAAWU,KAuBrE,SAAgBC,EAAeC,EAAMC,EAAMC,GACzCC,IAAIC,EAQJ,0BAPkC,mBAAvBhC,OAAOiC,YAChBD,EAAQ,IAAIhC,OAAOiC,YAAYJ,GAAOK,SAAS,EAAMC,YAAY,SAAML,KAEvEE,EAAQlB,SAASsB,YAAY,gBACvBC,gBAAgBR,GAAM,GAAM,EAAMC,GAGnCF,EAAKD,cAAcK,GAgB5B,SAAgBM,EAAUC,EAAUC,GAClC,sBAD4C1B,UACxCyB,EAASE,UAAkBF,GACP,iBAAbA,KAAiCG,MAAMC,KAAKH,EAAQI,iBAAiBL,IAC5EA,EAASM,UAAkBH,MAAMC,KAAKJ,MClG5C5B,IAAMmC,EAAO,6BAA0BrB,QAAQ,OAAQ,KACjDsB,GAAQC,MAAO,GAAIC,MAAO,GAAIC,IAAK,GAAIC,OAAQ,GAAIC,SAAU,GAAIC,IAAK,GAAIC,KAAM,GAAIC,GAAI,GAAIC,KAAM,IAClGC,EAAOxD,EAAS,YAAc,OAC9ByD,EAAO,kBAEb,SAAwBC,EAAOpB,EAAUqB,GACvCjD,IAAMkD,EAA2B,iBAAVD,EAAqBA,SAASA,GAC/CE,EAAmC,iBAAlBD,EAAQD,MAE/B,OAAOtB,EAASC,GAAUwB,iBAASJ,GACjChD,IAAMqD,EAAOL,EAAMM,mBAUnB,OARAN,EAAMO,aAAapB,EAAM,IACzBa,EAAMO,aAAaT,EAAM,YACzBE,EAAMO,aAAa,eAAgB,OACnCP,EAAMO,aAAa,oBAAqB,QAEpCJ,IAASE,EAAKG,UAAYN,EAAQD,OACtCtB,EAAS,WAAY0B,GAAMD,QAAQK,GACnCC,EAAYV,EAAOE,EAAQS,MACpBX,IAMX,SAASY,EAAgBvC,GACnBA,EAAMwC,SAAWxC,EAAMyC,QAAUzC,EAAM0C,SAAW1C,EAAM2C,kBAE5DrC,MAAaQ,OAASiB,iBAASJ,GAC7BhD,IAAMqD,EAAOL,EAAMM,mBACbK,EAAOX,IAAU3B,EAAM4C,QAAUZ,EAAKa,SAAS7C,EAAM4C,QACrDE,EAAOR,GAAuB,UAAftC,EAAMvB,MAAoB6B,EAASoB,EAAMM,GAAMe,gBAAQD,UAASA,EAAKD,SAAS7C,EAAM4C,UAAS,GAE9GE,EA4CR,SAAmBnB,EAAO7B,GACxB,GAAIH,EAAcgC,EAAO,eAAgB7B,GAAS,CAChDnB,IAAMmE,EAAOhD,EAAOkD,cACpBrB,EAAMsB,MAAQH,EAAKG,OAASH,EAAKI,YAAYC,OAC7CxB,EAAMyB,QACNf,EAAYV,GAAO,IAjDT0B,CAAS1B,GAAQ2B,cAAetB,EAAMgB,cAAeF,IAC1DT,EAAYV,EAAOW,KA0B5B,SAASiB,EAAO5B,EAAO3B,GACrBrB,IAAMqD,EAAOL,EAAMM,mBACbmB,EAAQ9C,EAAYoB,mBAAsBM,GAC1CwB,EAAQJ,EAAMK,QAAQ3E,SAAS4E,eACjCZ,GAAO,EAEP9C,EAAM2D,UAAY5C,EAAKM,KAAOrB,EAAM2D,UAAY5C,EAAKK,SAAU0B,EAAOM,EAAMQ,MACvE5D,EAAM2D,UAAY5C,EAAKO,MAAQtB,EAAM2D,UAAY5C,EAAKI,OAAQ2B,EAAOM,EAAM,GAC3EpD,EAAM2D,UAAY5C,EAAKS,KAAMsB,EAAOM,EAAMI,EAAQ,IAAMJ,EAAM,GAC9DpD,EAAM2D,UAAY5C,EAAKQ,GAAIuB,EAAOM,EAAMI,EAAQ,IAAMJ,EAAMQ,MAC5D5D,EAAM2D,UAAY5C,EAAKE,OAASjB,EAAM2D,UAAY5C,EAAKC,OAAOW,EAAMyB,QAE7Ef,EAAYV,EAAO3B,EAAM2D,UAAY5C,EAAKG,MAC7B,IAAT4B,GAAgB9C,EAAM6D,iBACtBf,GAAMA,EAAKM,QAsBjB,SAASf,EAAaV,EAAOW,kBAA+C,SAAxCX,EAAMmC,aAAa,kBACrDnC,EAAMM,mBAAmBK,EAAO,kBAAoB,gBAAgB,SAAU,IAC9EX,EAAMO,aAAa,gBAAiBI,GAGtC,SAASF,EAAWU,EAAMU,EAAO5B,GAC/BkB,EAAKiB,aAAa,eAAiBjB,EAAKZ,aAAa,aAAiBY,EAAKI,YAAYC,aAAWK,EAAM,UAAQ5B,EAAY,QAC5HkB,EAAKZ,aAAa,WAAY,aAhFhC3D,EAASuC,EAAM,QAASyB,GACxBhE,EAASuC,EAAM,QAASyB,GAcxBhE,EAASuC,EAAM,iBAAUkD,kBACvB,GAAKpB,EAAOmB,aAAajD,GAAzB,CACAnC,IAAMsF,EAAQrB,EAAOK,MAAMxD,QAAQ,yBAA0B,SAAW,KAClEyE,EAAQ,IAAIC,OAAOF,EAAO,OA6ClC,SAAmBtC,EAAO7B,GACpBH,EAAcgC,EAAO,aAAc7B,IACrCQ,EAASoB,EAAMC,EAAMM,oBAAoBmC,gBAAQC,EAAKvB,GACpDnE,IAAM2F,GAA8E,IAAvExB,EAAKI,YAAYqB,cAAcd,QAAQ9B,EAAMsB,MAAMsB,eAEhE,OADAzB,EAAKwB,EAAO,kBAAoB,gBAAgB,SAAU,IACnDA,EAAOD,EAAIG,OAAO1B,GAAQuB,OAC5BtC,QAAQK,GAjDjBqC,CAAS7B,GACPU,cAAeV,EAAOX,mBACtByC,gBAAS9C,UAAUD,EAAMiB,SAAShB,KAClC+C,mBAAYC,UAAQrF,EAAWqF,GAAKnF,QAAQyE,EAAO,+BACnD3E,QACA2E,OAIJ3F,EAASuC,EAAM,mBAAYd,GACzB,KAAIA,EAAMwC,SAAWxC,EAAMyC,QAAUzC,EAAM0C,SAA3C,CACA,GAAI1C,EAAM4C,OAAOmB,aAAajD,GAAO,OAAOyC,EAAMvD,EAAM4C,OAAQ5C,GAChE,IAAKD,IAAI8E,EAAK7E,EAAM4C,OAAQkC,SAAMD,EAAIA,EAAKA,EAAGE,cAC5C,IAAKD,EAAOD,EAAGG,yBAA2BF,EAAKf,aAAajD,GAAO,OAAOyC,EAAMuB,EAAM9E"}